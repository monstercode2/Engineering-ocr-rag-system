# ğŸš€ RAGFlow API æ¥å£æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

RAGFlowæä¾›äº†å®Œæ•´çš„RESTful APIï¼Œå¯ä»¥é€šè¿‡HTTPè°ƒç”¨æ¥å®ç°æ–‡æ¡£å¤„ç†ã€çŸ¥è¯†åº“ç®¡ç†ã€èŠå¤©å¯¹è¯ç­‰åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨çš„ä¸»è¦APIæ¥å£ã€‚

## ğŸ”‘ è®¤è¯æ–¹å¼

æ‰€æœ‰APIè°ƒç”¨éƒ½éœ€è¦åœ¨HTTPè¯·æ±‚å¤´ä¸­åŒ…å«APIå¯†é’¥ï¼š
```
Authorization: Bearer <YOUR_API_KEY>
Content-Type: application/json
```

## ğŸ“š ä¸»è¦APIæ¥å£åˆ†ç±»

### 1. æ•°æ®é›†(Knowledge Base)ç®¡ç† API

#### åˆ›å»ºæ•°æ®é›†
- **POST** `/api/v1/datasets`
- **åŠŸèƒ½**: åˆ›å»ºæ–°çš„çŸ¥è¯†åº“æ•°æ®é›†
- **å‚æ•°**:
  - `name`: æ•°æ®é›†åç§°
  - `description`: æ•°æ®é›†æè¿°  
  - `chunk_method`: åˆ†å—æ–¹æ³• (naive, qa, paper, book, etc.)
  - `embedding_model`: åµŒå…¥æ¨¡å‹
- **è¿”å›**: æ•°æ®é›†IDå’Œè¯¦ç»†ä¿¡æ¯

#### è·å–æ•°æ®é›†åˆ—è¡¨
- **GET** `/api/v1/datasets`
- **åŠŸèƒ½**: è·å–æ‰€æœ‰æ•°æ®é›†åˆ—è¡¨
- **å‚æ•°**: page, page_size, orderby, desc
- **è¿”å›**: æ•°æ®é›†åˆ—è¡¨å’Œæ€»æ•°

#### æ›´æ–°æ•°æ®é›†
- **PUT** `/api/v1/datasets/{dataset_id}`
- **åŠŸèƒ½**: æ›´æ–°æ•°æ®é›†é…ç½®
- **å‚æ•°**: name, description, embedding_model, etc.

#### åˆ é™¤æ•°æ®é›†
- **DELETE** `/api/v1/datasets`
- **åŠŸèƒ½**: åˆ é™¤æŒ‡å®šæ•°æ®é›†
- **å‚æ•°**: `ids` (æ•°æ®é›†IDæ•°ç»„)

### 2. æ–‡æ¡£ç®¡ç† API

#### ä¸Šä¼ æ–‡æ¡£
- **POST** `/api/v1/datasets/{dataset_id}/documents`
- **åŠŸèƒ½**: ä¸Šä¼ æ–‡æ¡£åˆ°æŒ‡å®šæ•°æ®é›†
- **å‚æ•°**: æ–‡ä»¶å¯¹è±¡ (multipart/form-data)
- **æ”¯æŒæ ¼å¼**: PDF, Word, TXT, Excel, PPTç­‰

#### è·å–æ–‡æ¡£åˆ—è¡¨
- **GET** `/api/v1/datasets/{dataset_id}/documents`
- **åŠŸèƒ½**: è·å–æ•°æ®é›†ä¸­çš„æ–‡æ¡£åˆ—è¡¨
- **å‚æ•°**: page, page_size, keywords, orderby

#### åˆ é™¤æ–‡æ¡£
- **DELETE** `/api/v1/datasets/{dataset_id}/documents`
- **åŠŸèƒ½**: åˆ é™¤æŒ‡å®šæ–‡æ¡£
- **å‚æ•°**: `ids` (æ–‡æ¡£IDæ•°ç»„)

#### è§£ææ–‡æ¡£
- **POST** `/api/v1/datasets/{dataset_id}/chunks`
- **åŠŸèƒ½**: è§£ææ–‡æ¡£å¹¶ç”ŸæˆçŸ¥è¯†å—
- **å‚æ•°**: `document_ids` (æ–‡æ¡£IDæ•°ç»„)

### 3. èŠå¤©åŠ©æ‰‹ç®¡ç† API

#### åˆ›å»ºèŠå¤©åŠ©æ‰‹
- **POST** `/api/v1/chats`
- **åŠŸèƒ½**: åˆ›å»ºåŸºäºæ•°æ®é›†çš„èŠå¤©åŠ©æ‰‹
- **å‚æ•°**:
  - `name`: åŠ©æ‰‹åç§°
  - `dataset_ids`: å…³è”çš„æ•°æ®é›†IDåˆ—è¡¨
  - `description`: åŠ©æ‰‹æè¿°
  - `llm`: LLMé…ç½®
  - `prompt`: æç¤ºè¯é…ç½®

#### è·å–èŠå¤©åŠ©æ‰‹åˆ—è¡¨
- **GET** `/api/v1/chats`
- **åŠŸèƒ½**: è·å–æ‰€æœ‰èŠå¤©åŠ©æ‰‹
- **å‚æ•°**: page, page_size, name, orderby

#### æ›´æ–°èŠå¤©åŠ©æ‰‹
- **PUT** `/api/v1/chats/{chat_id}`
- **åŠŸèƒ½**: æ›´æ–°èŠå¤©åŠ©æ‰‹é…ç½®

#### åˆ é™¤èŠå¤©åŠ©æ‰‹
- **DELETE** `/api/v1/chats`
- **åŠŸèƒ½**: åˆ é™¤èŠå¤©åŠ©æ‰‹

### 4. ä¼šè¯ç®¡ç† API

#### åˆ›å»ºä¼šè¯
- **POST** `/api/v1/chats/{chat_id}/sessions`
- **åŠŸèƒ½**: ä¸ºèŠå¤©åŠ©æ‰‹åˆ›å»ºæ–°ä¼šè¯
- **å‚æ•°**: 
  - `name`: ä¼šè¯åç§°
  - `user_id`: ç”¨æˆ·ID (å¯é€‰)

#### è·å–ä¼šè¯åˆ—è¡¨
- **GET** `/api/v1/chats/{chat_id}/sessions`
- **åŠŸèƒ½**: è·å–èŠå¤©åŠ©æ‰‹çš„æ‰€æœ‰ä¼šè¯

#### æ›´æ–°ä¼šè¯
- **PUT** `/api/v1/chats/{chat_id}/sessions/{session_id}`
- **åŠŸèƒ½**: æ›´æ–°ä¼šè¯ä¿¡æ¯

#### åˆ é™¤ä¼šè¯
- **DELETE** `/api/v1/chats/{chat_id}/sessions`
- **åŠŸèƒ½**: åˆ é™¤ä¼šè¯

### 5. å¯¹è¯ API (OpenAIå…¼å®¹)

#### èŠå¤©å¯¹è¯
- **POST** `/api/v1/chats_openai/{chat_id}/chat/completions`
- **åŠŸèƒ½**: ä¸èŠå¤©åŠ©æ‰‹è¿›è¡Œå¯¹è¯ (å…¼å®¹OpenAI APIæ ¼å¼)
- **å‚æ•°**:
  - `model`: æ¨¡å‹åç§° (ä»»æ„å€¼)
  - `messages`: æ¶ˆæ¯å†å²æ•°ç»„
  - `stream`: æ˜¯å¦æµå¼å“åº” (true/false)
- **è¿”å›**: èŠå¤©å›å¤ (æ”¯æŒæµå¼å’Œéæµå¼)

### 6. æœç´¢æ£€ç´¢ API

#### çŸ¥è¯†æ£€ç´¢
- **POST** `/api/v1/retrieval`
- **åŠŸèƒ½**: ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯
- **å‚æ•°**:
  - `kb_id`: æ•°æ®é›†ID
  - `question`: æŸ¥è¯¢é—®é¢˜
- **è¿”å›**: ç›¸å…³çŸ¥è¯†å—å’Œç›¸ä¼¼åº¦åˆ†æ•°

## ğŸ› ï¸ åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯

### 1. OCRç»“æœå¤„ç†æµç¨‹
```python
# 1. åˆ›å»ºæˆ–è·å–æ•°æ®é›†
POST /api/v1/datasets
{
    "name": "å·¥ç¨‹æ–‡æ¡£é›†",
    "description": "OCRå¤„ç†åçš„å·¥ç¨‹æ–‡æ¡£",
    "chunk_method": "naive",
    "embedding_model": "BAAI/bge-large-zh-v1.5@BAAI"
}

# 2. ä¸Šä¼ OCRæå–çš„æ–‡æœ¬å†…å®¹ä½œä¸ºæ–‡æ¡£
POST /api/v1/datasets/{dataset_id}/documents
# ä¸Šä¼ æ–‡æœ¬æ–‡ä»¶æˆ–ç›´æ¥ä¼ é€’OCRç»“æœ

# 3. è§£ææ–‡æ¡£ç”ŸæˆçŸ¥è¯†å—
POST /api/v1/datasets/{dataset_id}/chunks
{
    "document_ids": ["doc_id_1", "doc_id_2"]
}
```

### 2. æ™ºèƒ½é—®ç­”æµç¨‹
```python
# 1. åˆ›å»ºèŠå¤©åŠ©æ‰‹
POST /api/v1/chats
{
    "name": "å·¥ç¨‹æ–‡æ¡£åŠ©æ‰‹",
    "dataset_ids": ["dataset_id_1"],
    "description": "åŸºäºå·¥ç¨‹æ–‡æ¡£çš„æ™ºèƒ½åŠ©æ‰‹"
}

# 2. åˆ›å»ºä¼šè¯
POST /api/v1/chats/{chat_id}/sessions
{
    "name": "å·¥ç¨‹å’¨è¯¢ä¼šè¯"
}

# 3. è¿›è¡Œå¯¹è¯
POST /api/v1/chats_openai/{chat_id}/chat/completions
{
    "model": "ragflow",
    "messages": [
        {"role": "user", "content": "è¿™ä¸ªè®¾å¤‡çš„æŠ€æœ¯å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ"}
    ],
    "stream": false
}
```

### 3. çŸ¥è¯†æ£€ç´¢æµç¨‹
```python
# ç›´æ¥ä»çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯
POST /api/v1/retrieval
{
    "kb_id": "dataset_id",
    "question": "è®¾å¤‡ç»´æŠ¤å‘¨æœŸ"
}
```

## ğŸ”§ é›†æˆå»ºè®®

### 1. ç¯å¢ƒé…ç½®
```bash
# åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®
RAGFLOW_API_KEY=your_api_key_here
RAGFLOW_BASE_URL=http://localhost:9380
```

### 2. Pythonå®¢æˆ·ç«¯ä½¿ç”¨
```python
from web.utils.ragflow_api_client import get_ragflow_client

# è·å–å®¢æˆ·ç«¯å®ä¾‹
client = get_ragflow_client()

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
health = client.health_check()

# åˆ›å»ºæ•°æ®é›†
dataset = client.create_dataset("æˆ‘çš„æ•°æ®é›†", "æè¿°")

# ä¸Šä¼ æ–‡æ¡£å†…å®¹
result = client.upload_text_content(
    dataset_id, 
    ocr_text, 
    "document.txt"
)

# åˆ›å»ºèŠå¤©åŠ©æ‰‹
chat = client.create_chat_assistant(
    "åŠ©æ‰‹åç§°", 
    [dataset_id]
)

# è¿›è¡Œå¯¹è¯
answer = client.simple_chat(chat_id, "ç”¨æˆ·é—®é¢˜")
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **APIå¯†é’¥ç®¡ç†**: ç¡®ä¿APIå¯†é’¥çš„å®‰å…¨å­˜å‚¨ï¼Œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 
2. **é”™è¯¯å¤„ç†**: æ‰€æœ‰APIè°ƒç”¨éƒ½åº”åŒ…å«é€‚å½“çš„é”™è¯¯å¤„ç†
3. **æµé‡æ§åˆ¶**: æ³¨æ„APIè°ƒç”¨é¢‘ç‡é™åˆ¶
4. **æ•°æ®æ ¼å¼**: ç¡®ä¿ä¸Šä¼ çš„æ–‡æ¡£æ ¼å¼ç¬¦åˆè¦æ±‚
5. **æƒé™æ§åˆ¶**: æ¯ä¸ªAPIè°ƒç”¨éƒ½æœ‰æƒé™éªŒè¯ï¼Œç¡®ä¿å½“å‰ç”¨æˆ·æœ‰ç›¸åº”æƒé™

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **æ‰¹é‡æ“ä½œ**: å°½é‡ä½¿ç”¨æ‰¹é‡APIå‡å°‘ç½‘ç»œè¯·æ±‚
2. **ç¼“å­˜æœºåˆ¶**: å¯¹å¸¸ç”¨çš„æ•°æ®é›†å’ŒèŠå¤©åŠ©æ‰‹ä¿¡æ¯è¿›è¡Œç¼“å­˜
3. **å¼‚æ­¥å¤„ç†**: å¯¹äºå¤§æ–‡ä»¶ä¸Šä¼ å’Œè§£æï¼Œä½¿ç”¨å¼‚æ­¥æ–¹å¼å¤„ç†
4. **æµå¼å“åº”**: å¯¹äºé•¿å¯¹è¯ï¼Œä½¿ç”¨æµå¼APIæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

è¿™äº›APIæ¥å£ä¸ºæˆ‘ä»¬çš„å·¥ç¨‹æ–‡æ¡£æ™ºèƒ½è§£æç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„RAGé—®ç­”èƒ½åŠ›ï¼ğŸ¯ 